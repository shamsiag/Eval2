{"ast":null,"code":"import { resolveComponent as _resolveComponent, createVNode as _createVNode, createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString } from \"vue\";\nconst _hoisted_1 = {\n  class: \"shop-section\"\n};\nconst _hoisted_2 = {\n  class: \"cards-container\"\n};\nconst _hoisted_3 = [\"src\", \"alt\"];\nconst _hoisted_4 = {\n  class: \"product-name\"\n};\nconst _hoisted_5 = {\n  class: \"product-description\"\n};\nconst _hoisted_6 = {\n  class: \"product-price\"\n};\nconst _hoisted_7 = [\"onClick\"];\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_NavBar = _resolveComponent(\"NavBar\");\n  return _openBlock(), _createElementBlock(_Fragment, null, [_createVNode(_component_NavBar), _createElementVNode(\"section\", _hoisted_1, [_cache[0] || (_cache[0] = _createElementVNode(\"h2\", {\n    class: \"section-title\"\n  }, \"NOS\", -1 /* HOISTED */)), _cache[1] || (_cache[1] = _createElementVNode(\"h2\", {\n    class: \"section-title\"\n  }, \"PRODUITS\", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_2, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.products, (product, index) => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: index,\n      class: \"product-card\"\n    }, [_createElementVNode(\"img\", {\n      src: product.image || require('@/assets/item/default-product.png'),\n      alt: product.name,\n      class: \"product-image\"\n    }, null, 8 /* PROPS */, _hoisted_3), _createElementVNode(\"h3\", _hoisted_4, _toDisplayString(product.name), 1 /* TEXT */), _createElementVNode(\"p\", _hoisted_5, _toDisplayString(product.description), 1 /* TEXT */), _createElementVNode(\"p\", _hoisted_6, _toDisplayString($options.formatPrice(product.price_ttc)), 1 /* TEXT */), _createElementVNode(\"button\", {\n      class: \"product-button\",\n      onClick: $event => $options.addToCart(product)\n    }, \"Ajouter au panier\", 8 /* PROPS */, _hoisted_7)]);\n  }), 128 /* KEYED_FRAGMENT */))])])], 64 /* STABLE_FRAGMENT */);\n}","map":{"version":3,"names":["class","_createElementBlock","_Fragment","_createVNode","_component_NavBar","_createElementVNode","_hoisted_1","_hoisted_2","_renderList","$data","products","product","index","key","src","image","require","alt","name","_hoisted_3","_hoisted_4","_toDisplayString","_hoisted_5","description","_hoisted_6","$options","formatPrice","price_ttc","onClick","$event","addToCart","_hoisted_7"],"sources":["/Users/macbookpro/Sham/S6/stellarz-web/stellarz-b/stellar-web/src/views/ShopPage.vue"],"sourcesContent":["<template>\n  <NavBar />\n  <section class=\"shop-section\">\n    <h2 class=\"section-title\">NOS</h2>\n    <h2 class=\"section-title\">PRODUITS</h2>\n\n    <div class=\"cards-container\">\n      <div \n        v-for=\"(product, index) in products\" \n        :key=\"index\" \n        class=\"product-card\"\n      >\n        <img :src=\"product.image || require('@/assets/item/default-product.png')\" :alt=\"product.name\" class=\"product-image\" />\n        <h3 class=\"product-name\">{{ product.name }}</h3>\n        <p class=\"product-description\">{{ product.description }}</p>\n        <p class=\"product-price\">{{ formatPrice(product.price_ttc) }}</p>\n        <button class=\"product-button\" @click=\"addToCart(product)\">Ajouter au panier</button>\n      </div>\n    </div>\n  </section>\n</template>\n\n<script>\nimport axios from 'axios'; \nimport NavBar from '@/components/NavBar.vue';\n\nexport default {\n  name: 'ShopPage',\n  components: {\n    NavBar\n  },\n  data() {\n    return {\n      products: [], // Produits à afficher dans le shop\n      cartItems: [], // Articles du panier récupérés de Dolibarr\n      cartId: null, // ID de la commande brouillon\n      apiKey: localStorage.getItem('apiKey'), // API Key pour Dolibarr\n      apiLink: localStorage.getItem('apiLink'), // API Link pour Dolibarr\n    };\n  },\n  created() {\n    this.fetchProductsFromDolibarr(); // Récupérer les produits au moment de la création du composant\n    this.getCartItems(); // Récupérer les articles du panier\n  },\n  methods: {\n    async fetchProductsFromDolibarr() {\n      try {\n        console.log('Tentative de récupération des produits depuis Dolibarr...');\n        if (!this.apiKey || !this.apiLink) {\n          console.error('API Key ou API Link manquant');\n          throw new Error(\"API Key ou API Link manquant\");\n        }\n\n        const url = `${this.apiLink}/products`; // URL de l'API Dolibarr pour récupérer les produits\n        const response = await axios.get(url, {\n          headers: {\n            \"DOLAPIKEY\": this.apiKey,\n          },\n        });\n\n        if (response.status !== 200) {\n          console.error(`Erreur réseau: ${response.statusText}`);\n          throw new Error(\"Erreur de récupération des produits.\");\n        }\n\n        const products = response.data;\n        console.log(\"Réponse de l'API:\", products); \n        this.products = products.map(product => {\n          const tvaRate = product.tva_tx / 100;\n          const priceTtc = product.price * (1 + tvaRate);\n\n          return {\n            id: product.id,\n            name: product.label,\n            description: product.description || 'Aucune description disponible.',\n            image: product.fk_photo ? `${this.apiLink}/product/photos/${product.fk_photo}` : null,\n            price_ht: product.price,\n            price_ttc: priceTtc.toFixed(2),\n          };\n        });\n      } catch (error) {\n        console.error(\"Erreur lors de la récupération des produits:\", error);\n      }\n    },\n\n    async getCartItems() {\n      try {\n        console.log('Tentative de récupération des articles du panier...');\n        const clientId = localStorage.getItem('clientId');\n        if (!clientId || !this.apiKey || !this.apiLink) {\n          console.error('Données manquantes (ClientId, API Key ou API Link)');\n          throw new Error(\"Données manquantes (ClientId, API Key ou API Link)\");\n        }\n\n        const searchUrl = `${this.apiLink}/orders?fk_soc=${clientId}&status=0`;\n        const response = await axios.get(searchUrl, {\n          headers: {\n            \"DOLAPIKEY\": this.apiKey,\n          },\n        });\n\n        if (response.status !== 200) {\n          console.error(`Erreur réseau: ${response.statusText}`);\n          throw new Error(\"Erreur de récupération des commandes brouillons.\");\n        }\n\n        const orders = response.data;\n        console.log(\"Commandes brouillons:\", orders);\n\n        if (Array.isArray(orders) && orders.length > 0) {\n          const cartId = orders[0].id;\n          this.cartId = cartId;\n          this.fetchCartItems(cartId); // Récupérer les articles de cette commande\n        } else {\n          console.log(\"Aucune commande brouillon trouvée.\");\n        }\n      } catch (error) {\n        console.error(\"Erreur lors de la récupération du panier:\", error);\n      }\n    },\n\n    async fetchCartItems(cartId) {\n      try {\n        console.log(`Tentative de récupération des articles pour le panier ID: ${cartId}...`);\n        const url = `${this.apiLink}/orders/${cartId}/lines`;\n        const response = await axios.get(url, {\n          headers: {\n            \"DOLAPIKEY\": this.apiKey,\n          },\n        });\n\n        if (response.status !== 200) {\n          console.error(`Erreur réseau: ${response.statusText}`);\n          throw new Error(\"Erreur de récupération des lignes du panier.\");\n        }\n\n        const cartItems = response.data;\n        this.cartItems = cartItems;\n        console.log(\"Articles du panier:\", cartItems);\n      } catch (error) {\n        console.error(\"Erreur lors de la récupération des articles du panier:\", error);\n      }\n    },\n\n    formatPrice(price) {\n      return `${price} MGA`; // Formatage du prix avec la devise\n    },\n\n    async addToCart(product) {\n  console.log('Tentative d\\'ajout au panier pour le produit:', product);\n  const isLoggedIn = localStorage.getItem('authToken'); // Vérifier un token ou état d'authentification\n\n  if (!isLoggedIn) {\n    alert('Vous devez être connecté pour ajouter des produits au panier.');\n    this.$router.push({ name: 'login' });\n    return;\n  }\n\n  const itemData = {\n    fk_product: product.id,\n    qty: 1, // Toujours ajouter une quantité de 1\n    subprice: product.price,\n    tva_tx: product.tva_tx,\n    label: product.label,\n    product_desc: product.description || \"\",\n    product_ref: product.ref,\n    price: product.price,\n    product_tobuy: 1,\n    product_tosell: 1,\n    weight: product.weight || 0,\n    width: product.width || 0,\n    length: product.length || 0,\n    height: product.height || 0,\n    localtax1_tx: \"0.0000\", \n    localtax2_tx: \"0.0000\",\n    total_ht: product.price,\n    total_ttc: (product.price * (1 + product.tva_tx / 100)).toFixed(2),\n  };\n  console.log('Prix de vente:', product.price);\n  console.log('tva:', itemData.total_ttc);\n\n  try {\n    const response = await axios.post(\n      `${this.apiLink}/orders/${this.cartId}/lines`,\n      itemData,\n      {\n        headers: {\n          \"DOLAPIKEY\": this.apiKey,\n          \"Content-Type\": \"application/json\",\n        },\n      }\n    );\n\n    if (response.status === 200 || response.status === 201) {\n      console.log('Ajout au panier réussi');\n      this.fetchCartItems(this.cartId); // Recharger les articles du panier\n    } else {\n      console.error(\"Erreur lors de l’ajout au panier :\", response);\n    }\n  } catch (error) {\n    console.error(\"Erreur axios (add):\", error);\n  }\n},\n\n  },\n};\n</script>\n\n<style scoped>\n/* Optionnel : modifications spécifiques à la page Shop */\n.shop-section {\n  text-align: left;\n  padding: 40px 20px;\n}\n\n.section-title {\n  font-size: 56px;\n  font-family: 'DAWBE';\n  color: #F7F7F7;\n  margin-left: 115px;\n  margin-bottom: 0;\n  margin-top: 0;\n}\n\n@font-face {\n  font-family: 'PP Formula';\n  src: url('@/assets/fonts/PPFormula-NarrowRegular.otf') format('opentype');\n  font-weight: medium;\n}\n\n@font-face {\n  font-family: 'DAWBE';\n  src: url('@/assets/fonts/dawbe.otf') format('opentype');\n  font-weight: bold;\n}\n\n/* Section globale */\n.products-section {\n  text-align: left;\n  padding: 40px 20px;\n}\n\n/* Titre */\n.section-title {\n  font-size: 56px;\n  margin-left: 115px;\n  font-family: 'DAWBE';\n  color: #F7F7F7;\n  text-align: left;\n  margin-bottom: 0;\n  margin-top: 0;\n}\n\n/* Conteneur des cartes */\n.cards-container {\n  display: grid;\n  grid-template-columns: repeat(3, 1fr); /* 3 produits par ligne */\n  gap: 50px;\n  max-width: 75%; /* Ajuste à la largeur du parent */\n  overflow-x: hidden; /* Empêche le scroll horizontal */\n  overflow-y: auto; /* Défilement vertical */\n  padding-bottom: 10px;\n  margin-left: 25%;\n  height: 100vh; /* Ajuste la hauteur pour voir le scroll vertical */\n}\n\n/* Style des cartes */\n.product-card {\n  background-color: white;\n  padding: 15px;\n  border-radius: 10px;\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\n  transition: transform 0.3s ease, color 0.3s ease;\n  text-align: left;\n  width: 100%;\n  height: 499px;\n  flex-shrink: 0; \n  flex-grow: 0;\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n}\n\n.product-card:hover {\n  transform: scale(1.05);\n  color: #5AAAD8;\n}\n\n/* Image */\n.product-image {\n  width: 221px;\n  height: auto;\n  border-radius: 8px;\n  margin-left: 100px;\n}\n\n/* Nom du produit */\n.product-name {\n  font-size: 1.5em;\n  margin: 10px 0;\n  font-family: 'DAWBE';\n  color: #1E1E1E;\n  max-width: 250px;\n  word-wrap: break-word;\n  overflow-wrap: break-word;\n  white-space: normal;\n  margin-bottom: 0;\n}\n\n/* Description */\n.product-description {\n  margin-top: 0;\n  font-size: 1em;\n  color: #1E1E1E;\n  font-family: 'PP Formula', sans-serif;\n  margin-bottom: 10px;\n  max-width: 250px;\n  word-wrap: break-word;\n  overflow-wrap: break-word;\n  white-space: normal;\n}\n\n/* Bouton */\n.product-button {\n  padding: 10px 15px;\n  border: none;\n  background-color: #0E100E;\n  color: white;\n  cursor: pointer;\n  border-radius: 5px;\n  transition: background-color 0.3s;\n  font-family: 'PP Formula', sans-serif;\n  margin-top: auto;\n  align-self: flex-end;\n}\n\n.product-card:hover .product-name,\n.product-card:hover .product-description {\n  color: #5AAAD8;\n}\n\n.product-button:hover {\n  background-color: #5AAAD8;\n}\n.product-price {\n  font-size: 1.2em;\n  color: #1E1E1E;\n  margin-top: 10px;\n  font-family: 'PP Formula', sans-serif;\n}\n</style>\n"],"mappings":";;EAEWA,KAAK,EAAC;AAAc;;EAItBA,KAAK,EAAC;AAAiB;mBANhC;;EAaYA,KAAK,EAAC;AAAc;;EACrBA,KAAK,EAAC;AAAqB;;EAC3BA,KAAK,EAAC;AAAe;mBAfhC;;;uBAAAC,mBAAA,CAAAC,SAAA,SACEC,YAAA,CAAUC,iBAAA,GACVC,mBAAA,CAiBU,WAjBVC,UAiBU,G,0BAhBRD,mBAAA,CAAkC;IAA9BL,KAAK,EAAC;EAAe,GAAC,KAAG,sB,0BAC7BK,mBAAA,CAAuC;IAAnCL,KAAK,EAAC;EAAe,GAAC,UAAQ,sBAElCK,mBAAA,CAYM,OAZNE,UAYM,I,kBAXJN,mBAAA,CAUMC,SAAA,QAjBZM,WAAA,CAQmCC,KAAA,CAAAC,QAAQ,EAR3C,CAQgBC,OAAO,EAAEC,KAAK;yBADxBX,mBAAA,CAUM;MARHY,GAAG,EAAED,KAAK;MACXZ,KAAK,EAAC;QAENK,mBAAA,CAAsH;MAAhHS,GAAG,EAAEH,OAAO,CAACI,KAAK,IAAIC,OAAO;MAAwCC,GAAG,EAAEN,OAAO,CAACO,IAAI;MAAElB,KAAK,EAAC;4BAZ5GmB,UAAA,GAaQd,mBAAA,CAAgD,MAAhDe,UAAgD,EAAAC,gBAAA,CAApBV,OAAO,CAACO,IAAI,kBACxCb,mBAAA,CAA4D,KAA5DiB,UAA4D,EAAAD,gBAAA,CAA1BV,OAAO,CAACY,WAAW,kBACrDlB,mBAAA,CAAiE,KAAjEmB,UAAiE,EAAAH,gBAAA,CAArCI,QAAA,CAAAC,WAAW,CAACf,OAAO,CAACgB,SAAS,mBACzDtB,mBAAA,CAAqF;MAA7EL,KAAK,EAAC,gBAAgB;MAAE4B,OAAK,EAAAC,MAAA,IAAEJ,QAAA,CAAAK,SAAS,CAACnB,OAAO;OAAG,mBAAiB,iBAhBpFoB,UAAA,E","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}