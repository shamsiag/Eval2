{"ast":null,"code":"import { createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, createTextVNode as _createTextVNode } from \"vue\";\nconst _hoisted_1 = {\n  id: \"app\",\n  ref: \"document\"\n};\nconst _hoisted_2 = {\n  id: \"element-to-convert\"\n};\nconst _hoisted_3 = {\n  key: 0,\n  class: \"entete\"\n};\nconst _hoisted_4 = {\n  key: 1,\n  class: \"ref-commande\"\n};\nconst _hoisted_5 = {\n  key: 2,\n  class: \"detail-commande\"\n};\nconst _hoisted_6 = {\n  key: 3,\n  class: \"bas-de-page\"\n};\nconst _hoisted_7 = {\n  class: \"details-paiement\"\n};\nconst _hoisted_8 = {\n  class: \"small-table\"\n};\nconst _hoisted_9 = {\n  key: 0\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(_Fragment, null, [_createElementVNode(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_cache[9] || (_cache[9] = _createElementVNode(\"div\", {\n    class: \"logo\"\n  }, [_createElementVNode(\"img\", {\n    src: \"/Property 1=Variant2.png\",\n    alt: \"Logo de la marque\"\n  })], -1 /* HOISTED */)), $data.invoice ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3, [_createElementVNode(\"h1\", null, \"Facture \" + _toDisplayString($data.invoice.ref), 1 /* TEXT */), _createElementVNode(\"h3\", null, \"Date facturation : \" + _toDisplayString($options.formatDate($data.invoice.date_creation)), 1 /* TEXT */), _createElementVNode(\"h3\", null, \"Date échéance : \" + _toDisplayString($options.formatDate($data.invoice.date_lim_reglement)), 1 /* TEXT */)])) : _createCommentVNode(\"v-if\", true), _cache[10] || (_cache[10] = _createElementVNode(\"div\", {\n    class: \"emetteur\"\n  }, [_createElementVNode(\"h3\", null, \"VR 61 HF Ambohimiandra\"), _createElementVNode(\"h3\", null, \"101 Antananarivo\"), _createElementVNode(\"h3\", null, \"Madagascar\"), _createElementVNode(\"h3\", null, \"Tél.: +261349933136\")], -1 /* HOISTED */)), _cache[11] || (_cache[11] = _createElementVNode(\"div\", {\n    class: \"client\"\n  }, [_createElementVNode(\"b\", null, \"VR 61 HF Ambohimiandra\")], -1 /* HOISTED */)), $data.invoice ? (_openBlock(), _createElementBlock(\"div\", _hoisted_4, [_cache[1] || (_cache[1] = _createElementVNode(\"h4\", null, \"Commandes\", -1 /* HOISTED */)), _createElementVNode(\"h4\", null, _toDisplayString($data.invoice.ref), 1 /* TEXT */), _createElementVNode(\"h4\", null, \"Réf. commande : \" + _toDisplayString($data.invoice.linkedObjectsIds?.commande?.ref || 'N/A'), 1 /* TEXT */), _createElementVNode(\"h4\", null, \"Date de commande : \" + _toDisplayString($options.formatDate($data.invoice.date)), 1 /* TEXT */)])) : _createCommentVNode(\"v-if\", true), $data.invoice && $data.invoice.lines ? (_openBlock(), _createElementBlock(\"table\", _hoisted_5, [_cache[2] || (_cache[2] = _createElementVNode(\"tr\", null, [_createElementVNode(\"th\", {\n    class: \"detail-commande-designation\"\n  }, \"Désignation\"), _createElementVNode(\"th\", null, \"TVA\"), _createElementVNode(\"th\", null, \"P.U. HT\"), _createElementVNode(\"th\", null, \"Qté\"), _createElementVNode(\"th\", null, \"Total HT\")], -1 /* HOISTED */)), (_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.invoice.lines, (line, index) => {\n    return _openBlock(), _createElementBlock(\"tr\", {\n      key: index\n    }, [_createElementVNode(\"td\", null, _toDisplayString(line.desc || line.libelle || 'Produit/Service'), 1 /* TEXT */), _createElementVNode(\"td\", null, _toDisplayString(line.tva_tx) + \"%\", 1 /* TEXT */), _createElementVNode(\"td\", null, _toDisplayString($options.formatPrice(line.subprice)), 1 /* TEXT */), _createElementVNode(\"td\", null, _toDisplayString(line.qty), 1 /* TEXT */), _createElementVNode(\"td\", null, _toDisplayString($options.formatPrice(line.total_ht)), 1 /* TEXT */)]);\n  }), 128 /* KEYED_FRAGMENT */))])) : _createCommentVNode(\"v-if\", true), $data.invoice ? (_openBlock(), _createElementBlock(\"div\", _hoisted_6, [_createElementVNode(\"div\", null, [_cache[3] || (_cache[3] = _createElementVNode(\"b\", null, \"Total HT\", -1 /* HOISTED */)), _createTextVNode(\" \" + _toDisplayString($options.formatPrice($data.invoice.total_ht)), 1 /* TEXT */)]), _createElementVNode(\"div\", null, [_cache[4] || (_cache[4] = _createElementVNode(\"b\", null, \"Total TVA\", -1 /* HOISTED */)), _createTextVNode(\" \" + _toDisplayString($options.formatPrice($data.invoice.total_tva)), 1 /* TEXT */)]), _createElementVNode(\"div\", null, [_cache[5] || (_cache[5] = _createElementVNode(\"b\", null, \"Total TTC\", -1 /* HOISTED */)), _createTextVNode(\" \" + _toDisplayString($options.formatPrice($data.invoice.total_ttc)), 1 /* TEXT */)])])) : _createCommentVNode(\"v-if\", true), _createElementVNode(\"div\", _hoisted_7, [_createElementVNode(\"table\", _hoisted_8, [_cache[8] || (_cache[8] = _createElementVNode(\"thead\", null, [_createElementVNode(\"tr\", null, [_createElementVNode(\"th\", {\n    colspan: \"3\"\n  }, \"Versements déjà effectués\")])], -1 /* HOISTED */)), _createElementVNode(\"tbody\", null, [_cache[7] || (_cache[7] = _createElementVNode(\"tr\", null, [_createElementVNode(\"td\", null, \"Règlement\"), _createElementVNode(\"td\", null, \"Montant\"), _createElementVNode(\"td\", null, \"Type\")], -1 /* HOISTED */)), $data.invoice && $data.invoice.totalpaid === 0 ? (_openBlock(), _createElementBlock(\"tr\", _hoisted_9, _cache[6] || (_cache[6] = [_createElementVNode(\"td\", {\n    colspan: \"3\"\n  }, \"Aucun versement effectué\", -1 /* HOISTED */)]))) : _createCommentVNode(\"v-if\", true)])])])])], 512 /* NEED_PATCH */), _createElementVNode(\"button\", {\n    onClick: _cache[0] || (_cache[0] = (...args) => $options.exportToPDF && $options.exportToPDF(...args))\n  }, \"Export to PDF\")], 64 /* STABLE_FRAGMENT */);\n}","map":{"version":3,"names":["id","ref","key","class","_createElementBlock","_Fragment","_createElementVNode","_hoisted_1","_hoisted_2","src","alt","$data","invoice","_hoisted_3","_toDisplayString","$options","formatDate","date_creation","date_lim_reglement","_createCommentVNode","_hoisted_4","linkedObjectsIds","commande","date","lines","_hoisted_5","_renderList","line","index","desc","libelle","tva_tx","formatPrice","subprice","qty","total_ht","_hoisted_6","_createTextVNode","total_tva","total_ttc","_hoisted_7","_hoisted_8","colspan","totalpaid","_hoisted_9","_cache","onClick","args","exportToPDF"],"sources":["/Users/macbookpro/Sham/S6/stellarz-web/stellarz-b/stellar-web/src/views/InvoicePage.vue"],"sourcesContent":["<template>\n    <div id=\"app\" ref=\"document\">\n      <div id=\"element-to-convert\">\n        <div class=\"logo\">\n          <img src=\"/Property 1=Variant2.png\" alt=\"Logo de la marque\" />\n        </div>\n  \n        <div class=\"entete\" v-if=\"invoice\">\n          <h1>Facture {{ invoice.ref }}</h1>\n          <h3>Date facturation : {{ formatDate(invoice.date_creation) }}</h3>\n          <h3>Date échéance : {{ formatDate(invoice.date_lim_reglement) }}</h3>\n        </div>\n  \n        <div class=\"emetteur\">\n          <h3>VR 61 HF Ambohimiandra</h3>\n          <h3>101 Antananarivo</h3>\n          <h3>Madagascar</h3>\n          <h3>Tél.: +261349933136</h3>\n        </div>\n  \n        <div class=\"client\">\n          <b>VR 61 HF Ambohimiandra</b>\n        </div>\n  \n        <div class=\"ref-commande\" v-if=\"invoice\">\n          <h4>Commandes</h4>\n          <h4>{{ invoice.ref }}</h4>\n          <h4>Réf. commande : {{ invoice.linkedObjectsIds?.commande?.ref || 'N/A' }}</h4>\n          <h4>Date de commande : {{ formatDate(invoice.date) }}</h4>\n        </div>\n  \n        <table class=\"detail-commande\" v-if=\"invoice && invoice.lines\">\n          <tr>\n            <th class=\"detail-commande-designation\">Désignation</th>\n            <th>TVA</th>\n            <th>P.U. HT</th>\n            <th>Qté</th>\n            <th>Total HT</th>\n          </tr>\n          <tr v-for=\"(line, index) in invoice.lines\" :key=\"index\">\n            <td>{{ line.desc || line.libelle || 'Produit/Service' }}</td>\n            <td>{{ line.tva_tx }}%</td>\n            <td>{{ formatPrice(line.subprice) }}</td>\n            <td>{{ line.qty }}</td>\n            <td>{{ formatPrice(line.total_ht) }}</td>\n          </tr>\n        </table>\n  \n        <div class=\"bas-de-page\" v-if=\"invoice\">\n          <div><b>Total HT</b> {{ formatPrice(invoice.total_ht) }}</div>\n          <div><b>Total TVA</b> {{ formatPrice(invoice.total_tva) }}</div>\n          <div><b>Total TTC</b> {{ formatPrice(invoice.total_ttc) }}</div>\n        </div>\n  \n        <div class=\"details-paiement\">\n          <table class=\"small-table\">\n            <thead>\n              <tr>\n                <th colspan=\"3\">Versements déjà effectués</th>\n              </tr>\n            </thead>\n            <tbody>\n              <tr>\n                <td>Règlement</td>\n                <td>Montant</td>\n                <td>Type</td>\n              </tr>\n              <tr v-if=\"invoice && invoice.totalpaid === 0\">\n                <td colspan=\"3\">Aucun versement effectué</td>\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      </div>\n    </div>\n    <button @click=\"exportToPDF\">Export to PDF</button>\n  </template>\n  \n  <script>\n  import html2pdf from \"html2pdf.js\";\n  \n  export default {\n    name: \"InvoiceSection\",\n    data() {\n      return {\n        apiKey: localStorage.getItem(\"apiKey\"),\n        apiLink: localStorage.getItem(\"apiLink\"),\n        clientId: localStorage.getItem(\"clientId\"),\n        invoiceId: localStorage.getItem(\"invoiceId\"),\n        invoice: null\n      };\n    },\n    created() {\n      this.getInvoice();\n    },\n    \n    methods: {\n      exportToPDF() {\n        html2pdf(document.getElementById(\"element-to-convert\"), {\n          margin: 1,\n          filename: `facture-${this.invoice?.ref || 'sans-reference'}.pdf`,\n        });\n      },\n  \n      formatDate(timestamp) {\n        if (!timestamp) return 'N/A';\n        \n        // Si c'est un timestamp Unix (en secondes)\n        const date = new Date(timestamp * 1000);\n        return date.toLocaleDateString('fr-FR');\n      },\n      \n      formatPrice(price) {\n        if (!price) return '0,00';\n        return parseFloat(price).toLocaleString('fr-FR', {\n          minimumFractionDigits: 2,\n          maximumFractionDigits: 2\n        });\n      },\n  \n      async getInvoice() {\n        console.log(\"invoice Id:\", this.invoiceId);\n        try {\n          console.log('Tentative de récupération des factures depuis Dolibarr...');\n          if (!this.apiKey || !this.apiLink) throw new Error(\"API Key ou API Link manquant\");\n  \n          const url = `${this.apiLink}/invoices/${this.invoiceId}`;\n          console.log(\"url\", url);\n          const response = await fetch(url, {\n            headers: { \"Accept\": \"application/json\", DOLAPIKEY: this.apiKey },\n          });\n      \n          if (!response.ok) throw new Error(`Erreur réseau: ${response.statusText}`);\n          \n          // Récupérer directement les données JSON\n          this.invoice = await response.json();\n          console.log(\"Facture récupérée:\", this.invoice);\n          \n        } catch (error) {\n          console.error(\"Erreur lors de la récupération de la facture:\", error);\n        }\n      }\n    }\n  };\n  </script>\n    \n  <style>\n  #app {\n    margin-top: 60px;\n    color:#ddd\n  }\n  \n  .entete, .emetteur, .client, .ref-commande, .bas-de-page {\n    margin-bottom: 20px;\n  }\n  \n  .detail-commande {\n    width: 100%;\n    border-collapse: collapse;\n    margin-bottom: 20px;\n  }\n  \n  .detail-commande th, .detail-commande td {\n    border: 1px solid #ddd;\n    padding: 8px;\n    text-align: left;\n  }\n  \n  .detail-commande th {\n    background-color: #f2f2f2;\n  }\n  \n  .small-table {\n    width: 100%;\n    border-collapse: collapse;\n  }\n  \n  .small-table th, .small-table td {\n    border: 1px solid #ddd;\n    padding: 8px;\n    text-align: left;\n  }\n  \n  .bas-de-page {\n    display: flex;\n    flex-direction: column;\n    align-items: flex-end;\n  }\n  </style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}