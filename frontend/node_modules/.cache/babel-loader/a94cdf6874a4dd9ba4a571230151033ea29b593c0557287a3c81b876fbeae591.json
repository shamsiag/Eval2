{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport NavBar from '@/components/NavBar.vue';\nimport ShopHeader from '@/components/ShopHeader.vue';\nimport ProductList from '@/components/ProductList.vue';\nexport default {\n  name: 'ShopPage',\n  components: {\n    NavBar,\n    ShopHeader,\n    ProductList\n  },\n  data() {\n    return {\n      products: [],\n      cartItems: [],\n      cartId: null,\n      authToken: localStorage.getItem('authToken'),\n      apiLink: localStorage.getItem('apiLink') || 'http://localhost:8080/api/v1',\n      priceListVersionId: 105\n    };\n  },\n  async created() {\n    await this.fetchProducts();\n    this.loadCartFromStorage();\n  },\n  methods: {\n    async fetchProducts() {\n      try {\n        console.log('Récupération des produits iDempiere...');\n        if (!this.authToken) throw new Error('Token d\\'authentification manquant');\n        const filter = `M_PriceList_Version_ID eq ${this.priceListVersionId}`;\n        const url = `${this.apiLink}/models/M_Product?$select=M_Product_ID,Name&$expand=M_ProductPrice($select=M_PriceList_Version_ID,PriceList,PriceStd,PriceLimit;$filter=${filter})`;\n        const response = await fetch(url, {\n          headers: {\n            'Authorization': `Bearer ${this.authToken}`\n          }\n        });\n        if (!response.ok) throw new Error(`Erreur réseau: ${response.statusText}`);\n        const {\n          records\n        } = await response.json();\n        this.products = records.map(item => {\n          const priceInfo = item.M_ProductPrice && item.M_ProductPrice.length ? item.M_ProductPrice[0] : {\n            PriceStd: 0\n          };\n          return {\n            id: item.id || item.M_Product_ID,\n            name: item.Name,\n            description: 'Aucune description disponible.',\n            image: null,\n            price_ht: parseFloat(priceInfo.PriceStd),\n            price_ttc: parseFloat(priceInfo.PriceStd),\n            tva_tx: 0,\n            label: item.Name,\n            ref: null,\n            weight: null,\n            width: null,\n            length: null,\n            height: null,\n            note: 'Aucune note disponible.'\n          };\n        });\n        console.log('Produits chargés:', this.products);\n      } catch (error) {\n        console.error('Erreur lors de la récupération des produits :', error);\n      }\n    },\n    loadCartFromStorage() {\n      const storedCart = localStorage.getItem('cartItems');\n      if (storedCart) {\n        try {\n          this.cartItems = JSON.parse(storedCart);\n        } catch (e) {\n          console.error('Erreur de parsing du panier localStorage:', e);\n          this.cartItems = [];\n        }\n      }\n    },\n    saveCartToStorage() {\n      localStorage.setItem('cartItems', JSON.stringify(this.cartItems));\n    },\n    addToCart(product) {\n      const existingItem = this.cartItems.find(item => item.id === product.id);\n      if (existingItem) {\n        existingItem.qty += 1;\n      } else {\n        this.cartItems.push({\n          ...product,\n          qty: 1\n        });\n      }\n      this.saveCartToStorage();\n      if (this.$toast) {\n        this.$toast.success('Produit ajouté au panier !');\n      } else {\n        alert('Produit ajouté au panier !');\n      }\n    },\n    async addNote(productId, noteInput, currentNote) {\n      try {\n        if (noteInput > 10 || noteInput < 0) {\n          alert(\"La note doit être comprise entre 0 et 10\");\n          return;\n        }\n        let newNote;\n        if (currentNote !== 'Aucune note disponible.') {\n          newNote = (parseFloat(currentNote) + parseFloat(noteInput)) / 2;\n        } else {\n          newNote = parseFloat(noteInput);\n        }\n        const noteData = {\n          array_options: {\n            options_note: newNote.toString()\n          }\n        };\n        const response = await fetch(`${this.apiLink}/products/${productId}`, {\n          method: 'PUT',\n          headers: {\n            'DOLAPIKEY': this.apiKey,\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify(noteData)\n        });\n        if (!response.ok) {\n          throw new Error(`Erreur lors de la mise à jour de la note: ${response.status}`);\n        }\n        const productToUpdate = this.products.find(p => p.id === productId);\n        if (productToUpdate) {\n          productToUpdate.note = newNote;\n          productToUpdate.noteInput = '';\n        }\n        if (this.$toast) {\n          this.$toast.success(\"Note mise à jour avec succès!\");\n        } else {\n          alert(\"Note mise à jour avec succès!\");\n        }\n      } catch (error) {\n        console.error(\"Erreur lors de la mise à jour de la note:\", error);\n        if (this.$toast) {\n          this.$toast.error(\"Échec de la mise à jour de la note\");\n        } else {\n          alert(\"Échec de la mise à jour de la note\");\n        }\n      }\n    }\n  }\n};","map":{"version":3,"names":["NavBar","ShopHeader","ProductList","name","components","data","products","cartItems","cartId","authToken","localStorage","getItem","apiLink","priceListVersionId","created","fetchProducts","loadCartFromStorage","methods","console","log","Error","filter","url","response","fetch","headers","ok","statusText","records","json","map","item","priceInfo","M_ProductPrice","length","PriceStd","id","M_Product_ID","Name","description","image","price_ht","parseFloat","price_ttc","tva_tx","label","ref","weight","width","height","note","error","storedCart","JSON","parse","e","saveCartToStorage","setItem","stringify","addToCart","product","existingItem","find","qty","push","$toast","success","alert","addNote","productId","noteInput","currentNote","newNote","noteData","array_options","options_note","toString","method","apiKey","body","status","productToUpdate","p"],"sources":["/Users/macbookpro/Sham/S6/Eval2-1/frontend/src/views/ShopPage.vue"],"sourcesContent":["<template>\n  <div class=\"shop-container\">\n    <NavBar />\n    <ShopHeader title=\"NOS\" subtitle=\"PRODUITS\" />\n    <ProductList \n      :products=\"products\" \n      @add-to-cart=\"addToCart\" \n      @add-note=\"addNote\" \n    />\n  </div>\n</template>\n\n<script>\nimport NavBar from '@/components/NavBar.vue';\nimport ShopHeader from '@/components/ShopHeader.vue';\nimport ProductList from '@/components/ProductList.vue';\n\nexport default {\n  name: 'ShopPage',\n  components: {\n    NavBar,\n    ShopHeader,\n    ProductList\n  },\n  data() {\n    return {\n      products: [],\n      cartItems: [],\n      cartId: null,\n      authToken: localStorage.getItem('authToken'),\n      apiLink: localStorage.getItem('apiLink') || 'http://localhost:8080/api/v1',\n      priceListVersionId: 105\n    };\n  },\n  async created() {\n    await this.fetchProducts();\n    this.loadCartFromStorage();\n  },\n  methods: {\n    async fetchProducts() {\n      try {\n        console.log('Récupération des produits iDempiere...');\n        if (!this.authToken) throw new Error('Token d\\'authentification manquant');\n\n        const filter = `M_PriceList_Version_ID eq ${this.priceListVersionId}`;\n        const url = `${this.apiLink}/models/M_Product?$select=M_Product_ID,Name&$expand=M_ProductPrice($select=M_PriceList_Version_ID,PriceList,PriceStd,PriceLimit;$filter=${filter})`;\n\n        const response = await fetch(url, {\n          headers: { 'Authorization': `Bearer ${this.authToken}` }\n        });\n\n        if (!response.ok) throw new Error(`Erreur réseau: ${response.statusText}`);\n        const { records } = await response.json();\n\n        this.products = records.map(item => {\n          const priceInfo = (item.M_ProductPrice && item.M_ProductPrice.length)\n            ? item.M_ProductPrice[0]\n            : { PriceStd: 0 };\n\n          return {\n            id: item.id || item.M_Product_ID,\n            name: item.Name,\n            description: 'Aucune description disponible.',\n            image: null,\n            price_ht: parseFloat(priceInfo.PriceStd),\n            price_ttc: parseFloat(priceInfo.PriceStd),\n            tva_tx: 0,\n            label: item.Name,\n            ref: null,\n            weight: null,\n            width: null,\n            length: null,\n            height: null,\n            note: 'Aucune note disponible.'\n          };\n        });\n        console.log('Produits chargés:', this.products);\n      } catch (error) {\n        console.error('Erreur lors de la récupération des produits :', error);\n      }\n    },\n\n    loadCartFromStorage() {\n      const storedCart = localStorage.getItem('cartItems');\n      if (storedCart) {\n        try {\n          this.cartItems = JSON.parse(storedCart);\n        } catch (e) {\n          console.error('Erreur de parsing du panier localStorage:', e);\n          this.cartItems = [];\n        }\n      }\n    },\n\n    saveCartToStorage() {\n      localStorage.setItem('cartItems', JSON.stringify(this.cartItems));\n    },\n\n    addToCart(product) {\n      const existingItem = this.cartItems.find(item => item.id === product.id);\n      if (existingItem) {\n        existingItem.qty += 1;\n      } else {\n        this.cartItems.push({\n          ...product,\n          qty: 1\n        });\n      }\n\n      this.saveCartToStorage();\n\n      if (this.$toast) {\n        this.$toast.success('Produit ajouté au panier !');\n      } else {\n        alert('Produit ajouté au panier !');\n      }\n    },\n\n\n    async addNote(productId, noteInput, currentNote) {\n      try {\n        if(noteInput > 10 || noteInput < 0) {\n          alert(\"La note doit être comprise entre 0 et 10\");\n          return;\n        }\n        \n        let newNote;\n        \n        if (currentNote !== 'Aucune note disponible.') {\n          newNote = (parseFloat(currentNote) + parseFloat(noteInput)) / 2;\n        } else {\n          newNote = parseFloat(noteInput);\n        }\n        \n        const noteData = {\n          array_options: {\n            options_note: newNote.toString()\n          }\n        };\n        \n        const response = await fetch(`${this.apiLink}/products/${productId}`, {\n          method: 'PUT',\n          headers: {\n            'DOLAPIKEY': this.apiKey,\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify(noteData)\n        });\n        \n        if (!response.ok) {\n          throw new Error(`Erreur lors de la mise à jour de la note: ${response.status}`);\n        }\n        \n        const productToUpdate = this.products.find(p => p.id === productId);\n        if (productToUpdate) {\n          productToUpdate.note = newNote;\n          productToUpdate.noteInput = ''; \n        }\n        \n        if (this.$toast) {\n          this.$toast.success(\"Note mise à jour avec succès!\");\n        } else {\n          alert(\"Note mise à jour avec succès!\");\n        }\n        \n      } catch (error) {\n        console.error(\"Erreur lors de la mise à jour de la note:\", error);\n        if (this.$toast) {\n          this.$toast.error(\"Échec de la mise à jour de la note\");\n        } else {\n          alert(\"Échec de la mise à jour de la note\");\n        }\n      }\n    },\n  }\n};\n</script>\n\n<style scoped>\n.shop-container {\n  width: 100%;\n  min-height: 100vh;\n  background-color: #111;\n  overflow-x: hidden;\n}\n\n@font-face {\n  font-family: 'PP Formula';\n  src: url('@/assets/fonts/PPFormula-NarrowRegular.otf') format('opentype');\n  font-weight: medium;\n}\n\n@font-face {\n  font-family: 'DAWBE';\n  src: url('@/assets/fonts/dawbe.otf') format('opentype');\n  font-weight: bold;\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}