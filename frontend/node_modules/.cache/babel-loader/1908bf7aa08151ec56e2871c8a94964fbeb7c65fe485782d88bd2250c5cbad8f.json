{"ast":null,"code":"import { resolveComponent as _resolveComponent, createVNode as _createVNode, createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"sales-dashboard\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_NavBar = _resolveComponent(\"NavBar\");\n  const _component_SalesSummary = _resolveComponent(\"SalesSummary\");\n  const _component_ProductSalesList = _resolveComponent(\"ProductSalesList\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode(_component_NavBar), _cache[0] || (_cache[0] = _createElementVNode(\"h1\", {\n    class: \"title\"\n  }, \"Tableau de bord des ventes\", -1 /* HOISTED */)), _createVNode(_component_SalesSummary, {\n    \"total-sales\": $data.summary.total_sales\n  }, null, 8 /* PROPS */, [\"total-sales\"]), _createVNode(_component_ProductSalesList, {\n    products: $data.summary.product_sales\n  }, null, 8 /* PROPS */, [\"products\"])]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createVNode","_component_NavBar","_createElementVNode","_component_SalesSummary","$data","summary","total_sales","_component_ProductSalesList","products","product_sales"],"sources":["/Users/macbookpro/Sham/S6/Eval2-1/frontend/src/views/SalesDashboard.vue"],"sourcesContent":["<template>\n  <div class=\"sales-dashboard\">\n    <NavBar />\n    <h1 class=\"title\">Tableau de bord des ventes</h1>\n\n    <SalesSummary :total-sales=\"summary.total_sales\" />\n\n    <ProductSalesList :products=\"summary.product_sales\" />\n  </div>\n</template>\n\n<script>\nimport NavBar from \"@/components/NavBar.vue\";\nimport SalesSummary from \"@/components/SalesSummary.vue\";\nimport ProductSalesList from \"@/components/ProductSalesList.vue\";\n\nexport default {\n  name: \"SalesDashboard\",\n  components: {\n    NavBar,\n    SalesSummary,\n    ProductSalesList,\n  },\n  data() {\n    return {\n      summary: {\n        total_sales: 0,\n        product_sales: [],\n      },\n      authToken: localStorage.getItem('authToken'),\n      apiLink: localStorage.getItem('apiLink') || 'http://localhost:8080/api/v1'\n    };\n  },\n  methods: {\n    async fetchSales() {\n      try {\n        const url = `${this.apiLink}/models/C_Order?$filter=DocStatus eq 'IP' AND IsSOTrx eq true&$select=C_Order_ID,DocumentNo,DateOrdered&$expand=C_OrderLine($select=M_Product_ID,QtyOrdered,LineNetAmt;$expand=M_Product_ID($select=Name))`;\n        const headers = this.authToken\n          ? { 'Authorization': `Bearer ${this.authToken}` }\n          : {};\n        const response = await fetch(url, { headers });\n        if (!response.ok) throw new Error(`Erreur rÃ©seau: ${response.statusText}`);\n\n        const data = await response.json();\n        // Flatten all order lines\n        const lines = data.records.flatMap(order =>\n          order.C_OrderLine.map(line => ({\n            productId: line.M_Product_ID.id,\n            name: line.M_Product_ID.Name,\n            amount: parseFloat(line.LineNetAmt),\n            qty: parseFloat(line.QtyOrdered)\n          }))\n        );\n\n        // Total sales amount\n        const totalSales = lines.reduce((sum, l) => sum + l.amount, 0);\n\n        // Group by product\n        const map = {};\n        lines.forEach(l => {\n          if (!map[l.productId]) {\n            map[l.productId] = { productId: l.productId, name: l.name, total_sales: 0, total_qty: 0 };\n          }\n          map[l.productId].total_sales += l.amount;\n          map[l.productId].total_qty += l.qty;\n        });\n        const productSales = Object.values(map);\n\n        this.summary.total_sales = totalSales;\n        this.summary.product_sales = productSales;\n      } catch (error) {\n        console.error(\"Erreur de chargement des ventes :\", error);\n      }\n    }\n  },\n  mounted() {\n    this.fetchSales();\n  }\n};\n</script>\n\n<style scoped>\n.sales-dashboard {\n  max-width: 900px;\n  margin: 0 auto;\n  padding: 20px;\n}\n.title {\n  font-size: 2rem;\n  margin-bottom: 20px;\n}\n</style>\n"],"mappings":";;EACOA,KAAK,EAAC;AAAiB;;;;;uBAA5BC,mBAAA,CAOM,OAPNC,UAOM,GANJC,YAAA,CAAUC,iBAAA,G,0BACVC,mBAAA,CAAiD;IAA7CL,KAAK,EAAC;EAAO,GAAC,4BAA0B,sBAE5CG,YAAA,CAAmDG,uBAAA;IAApC,aAAW,EAAEC,KAAA,CAAAC,OAAO,CAACC;4CAEpCN,YAAA,CAAsDO,2BAAA;IAAnCC,QAAQ,EAAEJ,KAAA,CAAAC,OAAO,CAACI","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}